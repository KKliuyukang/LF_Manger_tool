<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‰¾æ£®è±ªå¨å°”çŸ©é˜µæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #2c3e50;
            color: #ecf0f1;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #34495e;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #3498db;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #2c3e50;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #3498db;
        }
        
        .test-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .test-result {
            margin: 15px 0;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status-display {
            background: #34495e;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #4a5f7a;
            margin: 15px 0;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px;
            background: #2c3e50;
            border-radius: 4px;
        }
        
        .status-label {
            font-weight: 500;
        }
        
        .status-value {
            color: #3498db;
            font-family: monospace;
        }
        
        /* å¼•å…¥è‰¾æ£®è±ªå¨å°”çŸ©é˜µæ ·å¼ */
        :root {
            --panel-bg: #2c3e50;
            --card-bg: #34495e;
            --text-primary: #ecf0f1;
            --text-secondary: #95a5a6;
            --text-muted: #7f8c8d;
            --primary-color: #3498db;
            --border-color: #4a5f7a;
        }
    </style>
    
    <!-- è‰¾æ£®è±ªå¨å°”çŸ©é˜µæ ·å¼ -->
    <link rel="stylesheet" href="components/eisenhower-matrix/eisenhower-modal.css">
</head>
<body>
    <div class="test-container">
        <h1>ğŸ—ï¸ è‰¾æ£®è±ªå¨å°”çŸ©é˜µåŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>1. æ¨¡å—åŠ è½½æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testModuleLoading()">æ£€æŸ¥æ¨¡å—åŠ è½½</button>
                <button class="btn btn-primary" onclick="testDataStructure()">æ£€æŸ¥æ•°æ®ç»“æ„</button>
            </div>
            <div id="module-loading-result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. åŸºç¡€åŠŸèƒ½æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="btn btn-success" onclick="testShowModal()">æ˜¾ç¤ºçŸ©é˜µå¼¹çª—</button>
                <button class="btn btn-warning" onclick="testAddTask()">æ·»åŠ æµ‹è¯•ä»»åŠ¡</button>
                <button class="btn btn-primary" onclick="testDataPersistence()">æµ‹è¯•æ•°æ®æŒä¹…åŒ–</button>
            </div>
            <div id="basic-function-result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. ä»»åŠ¡ç®¡ç†æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="btn btn-success" onclick="createTestTasks()">åˆ›å»ºæµ‹è¯•ä»»åŠ¡</button>
                <button class="btn btn-primary" onclick="listAllTasks()">æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡</button>
                <button class="btn btn-warning" onclick="clearAllTasks()">æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡</button>
            </div>
            <div id="task-management-result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. æ•°æ®çŠ¶æ€æ˜¾ç¤º</h3>
            <div class="status-display" id="data-status">
                <!-- æ•°æ®çŠ¶æ€å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            <button class="btn btn-primary" onclick="refreshDataStatus()">åˆ·æ–°çŠ¶æ€</button>
        </div>
    </div>

    <!-- æ¨¡æ‹ŸgameDataå…¨å±€å˜é‡ -->
    <script>
        // æ¨¡æ‹ŸgameDataç»“æ„
        window.gameData = {
            eisenhowerTasks: null
        };
        
        // æ¨¡æ‹ŸsaveToCloudå‡½æ•°
        window.saveToCloud = function() {
            console.log('ğŸ’¾ æ¨¡æ‹Ÿæ•°æ®ä¿å­˜åˆ°äº‘ç«¯');
        };
    </script>
    
    <!-- åŠ è½½è‰¾æ£®è±ªå¨å°”çŸ©é˜µæ¨¡å— -->
    <script src="components/eisenhower-matrix/eisenhower-modal.js"></script>
    
    <script>
        // æµ‹è¯•æ¨¡å—åŠ è½½
        function testModuleLoading() {
            const resultDiv = document.getElementById('module-loading-result');
            let html = '<div class="test-result info">æ­£åœ¨æ£€æŸ¥æ¨¡å—åŠ è½½çŠ¶æ€...</div>';
            resultDiv.innerHTML = html;
            
            setTimeout(() => {
                const tests = [
                    {
                        name: 'EisenhowerMatrix å¯¹è±¡',
                        test: () => typeof window.EisenhowerMatrix === 'object'
                    },
                    {
                        name: 'init æ–¹æ³•',
                        test: () => typeof window.EisenhowerMatrix.init === 'function'
                    },
                    {
                        name: 'showModal æ–¹æ³•',
                        test: () => typeof window.EisenhowerMatrix.showModal === 'function'
                    },
                    {
                        name: 'addTask æ–¹æ³•',
                        test: () => typeof window.EisenhowerMatrix.addTask === 'function'
                    }
                ];
                
                let results = [];
                let allPassed = true;
                
                tests.forEach(test => {
                    const passed = test.test();
                    results.push(`${passed ? 'âœ…' : 'âŒ'} ${test.name}: ${passed ? 'é€šè¿‡' : 'å¤±è´¥'}`);
                    if (!passed) allPassed = false;
                });
                
                const resultClass = allPassed ? 'success' : 'error';
                const summary = allPassed ? 'æ‰€æœ‰æ¨¡å—åŠ è½½æˆåŠŸï¼' : 'éƒ¨åˆ†æ¨¡å—åŠ è½½å¤±è´¥ï¼';
                
                html = `<div class="test-result ${resultClass}">
                    <strong>${summary}</strong><br>
                    ${results.join('<br>')}
                </div>`;
                
                resultDiv.innerHTML = html;
            }, 100);
        }
        
        // æµ‹è¯•æ•°æ®ç»“æ„
        function testDataStructure() {
            const resultDiv = document.getElementById('module-loading-result');
            
            try {
                // åˆå§‹åŒ–æ•°æ®ç»“æ„
                if (window.EisenhowerMatrix) {
                    window.EisenhowerMatrix.initDataStructure();
                }
                
                const data = window.gameData.eisenhowerTasks;
                const tests = [
                    {
                        name: 'eisenhowerTasks å­˜åœ¨',
                        test: () => data !== null && data !== undefined
                    },
                    {
                        name: 'taskPool æ•°ç»„',
                        test: () => Array.isArray(data.taskPool)
                    },
                    {
                        name: 'quadrants å¯¹è±¡',
                        test: () => typeof data.quadrants === 'object'
                    },
                    {
                        name: 'å››ä¸ªè±¡é™å­˜åœ¨',
                        test: () => data.quadrants['urgent-important'] && 
                                   data.quadrants['important'] && 
                                   data.quadrants['urgent'] && 
                                   data.quadrants['neither']
                    }
                ];
                
                let results = [];
                let allPassed = true;
                
                tests.forEach(test => {
                    const passed = test.test();
                    results.push(`${passed ? 'âœ…' : 'âŒ'} ${test.name}: ${passed ? 'é€šè¿‡' : 'å¤±è´¥'}`);
                    if (!passed) allPassed = false;
                });
                
                const resultClass = allPassed ? 'success' : 'error';
                const summary = allPassed ? 'æ•°æ®ç»“æ„åˆå§‹åŒ–æˆåŠŸï¼' : 'æ•°æ®ç»“æ„åˆå§‹åŒ–å¤±è´¥ï¼';
                
                resultDiv.innerHTML = `<div class="test-result ${resultClass}">
                    <strong>${summary}</strong><br>
                    ${results.join('<br>')}<br>
                    <strong>å½“å‰æ•°æ®:</strong><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">
                    <strong>æ•°æ®ç»“æ„æµ‹è¯•å¤±è´¥ï¼</strong><br>
                    é”™è¯¯: ${error.message}
                </div>`;
            }
        }
        
        // æµ‹è¯•æ˜¾ç¤ºå¼¹çª—
        function testShowModal() {
            const resultDiv = document.getElementById('basic-function-result');
            
            try {
                if (window.EisenhowerMatrix) {
                    window.EisenhowerMatrix.showModal();
                    resultDiv.innerHTML = `<div class="test-result success">
                        âœ… çŸ©é˜µå¼¹çª—å·²æ˜¾ç¤ºï¼<br>
                        è¯·æ£€æŸ¥å¼¹çª—æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºï¼Œå¸ƒå±€æ˜¯å¦æ­£ç¡®ã€‚
                    </div>`;
                } else {
                    throw new Error('EisenhowerMatrix æ¨¡å—æœªåŠ è½½');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">
                    âŒ æ˜¾ç¤ºå¼¹çª—å¤±è´¥ï¼<br>
                    é”™è¯¯: ${error.message}
                </div>`;
            }
        }
        
        // æµ‹è¯•æ·»åŠ ä»»åŠ¡
        function testAddTask() {
            const resultDiv = document.getElementById('basic-function-result');
            
            try {
                if (!window.EisenhowerMatrix) {
                    throw new Error('EisenhowerMatrix æ¨¡å—æœªåŠ è½½');
                }
                
                // æ¨¡æ‹Ÿæ·»åŠ ä»»åŠ¡
                const testTitle = `æµ‹è¯•ä»»åŠ¡ ${Date.now()}`;
                const testDeadline = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                
                // åˆ›å»ºæ¨¡æ‹Ÿè¾“å…¥å…ƒç´ 
                const mockTitleInput = document.createElement('input');
                mockTitleInput.id = 'new-task-title';
                mockTitleInput.value = testTitle;
                document.body.appendChild(mockTitleInput);
                
                const mockDeadlineInput = document.createElement('input');
                mockDeadlineInput.id = 'new-task-deadline';
                mockDeadlineInput.value = testDeadline;
                document.body.appendChild(mockDeadlineInput);
                
                // æ·»åŠ ä»»åŠ¡
                window.EisenhowerMatrix.addTask();
                
                // æ¸…ç†æ¨¡æ‹Ÿå…ƒç´ 
                document.body.removeChild(mockTitleInput);
                document.body.removeChild(mockDeadlineInput);
                
                const taskCount = window.gameData.eisenhowerTasks.taskPool.length;
                
                resultDiv.innerHTML = `<div class="test-result success">
                    âœ… ä»»åŠ¡æ·»åŠ æµ‹è¯•æˆåŠŸï¼<br>
                    ä»»åŠ¡æ ‡é¢˜: ${testTitle}<br>
                    æˆªæ­¢æ—¥æœŸ: ${testDeadline}<br>
                    å½“å‰ä»»åŠ¡æ€»æ•°: ${taskCount}
                </div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">
                    âŒ æ·»åŠ ä»»åŠ¡æµ‹è¯•å¤±è´¥ï¼<br>
                    é”™è¯¯: ${error.message}
                </div>`;
            }
        }
        
        // åˆ›å»ºæµ‹è¯•ä»»åŠ¡
        function createTestTasks() {
            const resultDiv = document.getElementById('task-management-result');
            
            try {
                if (!window.EisenhowerMatrix) {
                    throw new Error('EisenhowerMatrix æ¨¡å—æœªåŠ è½½');
                }
                
                window.EisenhowerMatrix.initDataStructure();
                
                const testTasks = [
                    { title: 'ç´§æ€¥ä¼šè®®å‡†å¤‡', deadline: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] },
                    { title: 'é•¿æœŸé¡¹ç›®è§„åˆ’', deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] },
                    { title: 'å›å¤é‚®ä»¶', deadline: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] },
                    { title: 'æ•´ç†æ¡Œé¢', deadline: null },
                    { title: 'å­¦ä¹ æ–°æŠ€èƒ½', deadline: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] }
                ];
                
                let addedCount = 0;
                testTasks.forEach(task => {
                    const taskObj = {
                        id: 'task_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        title: task.title,
                        description: '',
                        deadline: task.deadline,
                        status: 'active',
                        quadrant: null,
                        createdAt: Date.now(),
                        completedAt: null
                    };
                    
                    window.gameData.eisenhowerTasks.taskPool.push(taskObj);
                    addedCount++;
                });
                
                resultDiv.innerHTML = `<div class="test-result success">
                    âœ… æˆåŠŸåˆ›å»º ${addedCount} ä¸ªæµ‹è¯•ä»»åŠ¡ï¼<br>
                    ä»»åŠ¡åˆ—è¡¨:<br>
                    ${testTasks.map(task => `â€¢ ${task.title} ${task.deadline ? `(${task.deadline})` : '(æ— æˆªæ­¢æ—¥æœŸ)'}`).join('<br>')}
                </div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">
                    âŒ åˆ›å»ºæµ‹è¯•ä»»åŠ¡å¤±è´¥ï¼<br>
                    é”™è¯¯: ${error.message}
                </div>`;
            }
        }
        
        // æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
        function listAllTasks() {
            const resultDiv = document.getElementById('task-management-result');
            
            try {
                const data = window.gameData.eisenhowerTasks;
                if (!data) {
                    throw new Error('ä»»åŠ¡æ•°æ®æœªåˆå§‹åŒ–');
                }
                
                const activeTasks = data.taskPool.filter(task => task.status === 'active');
                
                if (activeTasks.length === 0) {
                    resultDiv.innerHTML = `<div class="test-result info">
                        ğŸ“‹ å½“å‰æ²¡æœ‰æ´»è·ƒä»»åŠ¡<br>
                        ç‚¹å‡»"åˆ›å»ºæµ‹è¯•ä»»åŠ¡"æ¥æ·»åŠ ä¸€äº›ä»»åŠ¡
                    </div>`;
                    return;
                }
                
                const taskList = activeTasks.map(task => {
                    const deadlineText = task.deadline ? 
                        `æˆªæ­¢: ${task.deadline}` : 
                        'æ— æˆªæ­¢æ—¥æœŸ';
                    const quadrantText = task.quadrant || 'æœªåˆ†ç±»';
                    return `â€¢ ${task.title} (${deadlineText}, ${quadrantText})`;
                }).join('<br>');
                
                resultDiv.innerHTML = `<div class="test-result info">
                    ğŸ“‹ å½“å‰æ´»è·ƒä»»åŠ¡ (${activeTasks.length} ä¸ª):<br>
                    ${taskList}
                </div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">
                    âŒ æŸ¥çœ‹ä»»åŠ¡å¤±è´¥ï¼<br>
                    é”™è¯¯: ${error.message}
                </div>`;
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡
        function clearAllTasks() {
            const resultDiv = document.getElementById('task-management-result');
            
            try {
                if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡å—ï¼Ÿ')) {
                    return;
                }
                
                window.EisenhowerMatrix.initDataStructure();
                window.gameData.eisenhowerTasks.taskPool = [];
                window.gameData.eisenhowerTasks.quadrants = {
                    "urgent-important": [],
                    "important": [],
                    "urgent": [],
                    "neither": []
                };
                
                resultDiv.innerHTML = `<div class="test-result success">
                    âœ… æ‰€æœ‰ä»»åŠ¡å·²æ¸…ç©ºï¼
                </div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">
                    âŒ æ¸…ç©ºä»»åŠ¡å¤±è´¥ï¼<br>
                    é”™è¯¯: ${error.message}
                </div>`;
            }
        }
        
        // åˆ·æ–°æ•°æ®çŠ¶æ€
        function refreshDataStatus() {
            const statusDiv = document.getElementById('data-status');
            
            try {
                const data = window.gameData.eisenhowerTasks;
                
                if (!data) {
                    statusDiv.innerHTML = `<div class="status-item">
                        <span class="status-label">æ•°æ®çŠ¶æ€</span>
                        <span class="status-value">æœªåˆå§‹åŒ–</span>
                    </div>`;
                    return;
                }
                
                const totalTasks = data.taskPool.filter(task => task.status === 'active').length;
                const categorizedTasks = Object.values(data.quadrants).flat().length;
                const uncategorizedTasks = totalTasks - categorizedTasks;
                
                const quadrantCounts = Object.entries(data.quadrants).map(([key, tasks]) => {
                    const names = {
                        'urgent-important': 'é‡è¦ä¸”ç´§æ€¥',
                        'important': 'é‡è¦ä¸ç´§æ€¥',
                        'urgent': 'ç´§æ€¥ä¸é‡è¦',
                        'neither': 'ä¸é‡è¦ä¸ç´§æ€¥'
                    };
                    return `${names[key]}: ${tasks.length}`;
                }).join(', ');
                
                statusDiv.innerHTML = `
                    <div class="status-item">
                        <span class="status-label">æ€»ä»»åŠ¡æ•°</span>
                        <span class="status-value">${totalTasks}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å·²åˆ†ç±»ä»»åŠ¡</span>
                        <span class="status-value">${categorizedTasks}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å¾…åˆ†ç±»ä»»åŠ¡</span>
                        <span class="status-value">${uncategorizedTasks}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">è±¡é™åˆ†å¸ƒ</span>
                        <span class="status-value">${quadrantCounts}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æœ€åä»»åŠ¡ID</span>
                        <span class="status-value">${data.lastTaskId}</span>
                    </div>
                `;
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="status-item">
                    <span class="status-label">é”™è¯¯</span>
                    <span class="status-value">${error.message}</span>
                </div>`;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                testModuleLoading();
                refreshDataStatus();
            }, 500);
        });
    </script>
</body>
</html> 